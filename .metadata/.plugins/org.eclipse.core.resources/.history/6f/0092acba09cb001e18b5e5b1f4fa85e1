package java.student.registration;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;
import java.sql.Statement;

public class UserDao {
	private String dburl = "jdbc:postgresql://localhost:5432/studentdb";
	private String username = "postgres";
	private String password = "Godbewithusall";
	private String dbdriver = "org.postgresql.Driver";
//	private static final String INSERT_STUDENT_SQL = "INSERT INTO users (name, email, password, role) VALUES (?, ?, ?, ?);";
//	private static final String CHECK_CREDENTIALS_AND_ROLE_SQL ="SELECT * FROM users WHERE email = ?;";
	public Connection getConnection() throws SQLException {
		try {
			Class.forName(dbdriver);
		} catch (ClassNotFoundException e) {
			e.printStackTrace();
		}

		Connection connection = DriverManager.getConnection(dburl, username, password);

		// Create the table if it doesn't exist
		createUsersTableIfNotExists(connection);

		return connection;
	}

	private void createUsersTableIfNotExists(Connection connection) {
		String createTableSQL = "CREATE TABLE IF NOT EXISTS users (" +
				"id SERIAL PRIMARY KEY," +
				"name VARCHAR(255) NOT NULL," +
				"email VARCHAR(255) NOT NULL," +
				"password VARCHAR(255) NOT NULL," +
				"role VARCHAR(255) NOT NULL)";
		try (Statement statement = connection.createStatement()) {
			statement.executeUpdate(createTableSQL);
		} catch (SQLException e) {
			e.printStackTrace();
}
}
}
